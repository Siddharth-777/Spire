<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spire - AI Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="loader" class="loader-container">
        <div class="loader">
            <div class="loading">
                <svg height="48px" width="64px">
                    <polyline id="back" points="0.157 23.954, 14 23.954, 21.843 48, 43 0, 50 24, 64 24"></polyline>
                    <polyline id="front" points="0.157 23.954, 14 23.954, 21.843 48, 43 0, 50 24, 64 24"></polyline>
                </svg>
            </div>
            <div class="loader-text">Loading Spire...</div>
        </div>
    </div>

    <nav>
        <div class="logo" onclick="switchTab('home')" style="cursor: pointer;">Spire</div>
        <div class="nav-links">
            <button class="nav-btn active" data-tab="home">Home</button>
            <div class="dropdown">
                <button class="dropdown-toggle">
                    Workspace
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="switchTab('workspace')">Eve.ai</button>
                    <button class="dropdown-item" onclick="switchTab('code-editor')">Code Editor</button>
                </div>
            </div>
            <button class="nav-btn" data-tab="about">About</button>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
            <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 17C14.7614 17 17 14.7614 17 12C17 9.23858 14.7614 7 12 7C9.23858 7 7 9.23858 7 12C7 14.7614 9.23858 17 12 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="sign-in-btn">Sign in</button>
    </nav>

    <main>
        <!-- Home Tab Content -->
        <div class="tab-content active" id="home">
            <div class="hero">
                <div class="hero-banner">
                    <img src="./images/city.jpg" alt="EVE Banner" class="banner-image">
                    <div class="banner-overlay"></div>
                </div>
                <div class="hero-content">
                    <h1>Welcome to Spire – The Future of Learning</h1>
                    <p class="subtitle">Empowering Students with AI</p>
                    <p class="hero-description">Spire is an advanced AI-powered learning assistant designed to help students grasp complex concepts effortlessly. Whether you're looking for instant answers, in-depth explanations, or hands-on coding practice, Spire provides a seamless and interactive experience to enhance your learning journey.</p>
                    <button class="cta-button" onclick="switchTab('workspace')">Try Spire Now</button>
                </div>
            </div>

            <section class="features">
                <h2>Why Choose Spire?</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>Instant AI-Powered Assistance</h3>
                        <p>Get precise, well-structured answers to any academic or technical question. Spire is built to provide clear, insightful, and accurate responses, ensuring that students receive high-quality information instantly.</p>
                    </div>
                    <div class="feature-card">
                        <h3>AI-Generated Video Explanations</h3>
                        <p>Visual learning is more effective. Spire transforms complex topics into engaging video explanations, making it easier to understand even the most challenging subjects.</p>
                    </div>
                    <div class="feature-card">
                        <h3>Integrated Code Editor</h3>
                        <p>For students and developers, Spire includes a fully functional code editor. Write, test, and debug code directly within the platform, eliminating the need for external software.</p>
                    </div>
                    <div class="feature-card">
                        <h3>Smart and Personalized Learning</h3>
                        <p>Spire adapts to your learning style, offering tailored recommendations and personalized study materials to help you learn at your own pace.</p>
                    </div>
                    <div class="feature-card">
                        <h3>Seamless Experience</h3>
                        <p>With an intuitive interface and powerful AI capabilities, Spire ensures a smooth and efficient learning experience, accessible to students of all levels.</p>
                    </div>
                </div>
            </section>

            <section class="cta-section">
                <h2>Unlock Your Full Potential</h2>
                <p>Education should be engaging, accessible, and innovative. Spire is here to revolutionize the way students learn by combining AI-driven insights, multimedia resources, and interactive tools into one powerful platform.</p>
                <p class="cta-text">Start exploring Spire today and take your learning to the next level.</p>
                <button class="cta-button secondary" onclick="switchTab('workspace')">Get Started</button>
            </section>
        </div>

        <!-- Workspace Tab Content -->
        <div class="tab-content" id="workspace">
            <div class="workspace-layout">
                <!-- Left Sidebar -->
                <div class="workspace-sidebar">
                    <button class="new-chat-btn" onclick="createNewChat()">
                        <span>+ New Chat</span>
                    </button>
                    <div class="chat-history">
                        <!-- Empty initially, chats will be added dynamically -->
                    </div>
                    <div class="sidebar-footer">
                        <!-- This button will be shown/hidden based on sign in status -->
                        <button class="profile-btn" id="profileButton" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Profile</span>
                        </button>

                        <!-- This button will be shown/hidden based on sign in status -->
                        <button class="signin-btn" id="sidebarSignInButton">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 17L15 12L10 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M15 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Sign in</span>
                        </button>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="workspace-main">
                    <!-- Chat Area -->
                    <div class="chat-area">
                        <div class="chat-messages">
                            <!-- Messages will appear here -->
                            <div class="welcome-message">
                                <h2>Welcome to Eve.ai</h2>
                                <p>How can I help you today?</p>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <textarea
                                    class="chat-input"
                                    placeholder="Message Spire..."
                                    rows="1"
                                ></textarea>
                                <button class="send-button">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Tab Content -->
        <div class="tab-content" id="about">
            <div class="about-container">
                <h2>Meet the Team</h2>
                <p class="about-description">We're a passionate team dedicated to making AI accessible and helpful for everyone.</p>

                <div class="team-grid">
                    <div class="team-member">
                        <div class="member-image">
                            <!-- Update the src with your actual image filename -->
                            <img src="./images/sid.jpg" alt="Siddharth S">
                        </div>
                        <h3>Siddharth S</h3>
                        <p class="role">Founder & Developer</p>
                        <p class="bio">A passionate developer with a vision to make AI more accessible and user-friendly.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Editor Tab Content -->
        <div class="tab-content" id="code-editor">
            <div class="code-editor-container">
                <div class="code-editor-main">
                    <div class="editor-header">
                        <select id="languageSelect">
                            <option value="python" selected>Python</option>
                        </select>
                    </div>
                    <div class="editor-content">
                        <textarea id="codeEditor" spellcheck="false" placeholder="Write your Python code here..."></textarea>
                    </div>
                    <div class="editor-footer">
                        <button class="run-code-btn" onclick="runCode()">Run Code</button>
                        <div class="output-panel" id="outputPanel">
                            <!-- Code output will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add modal for new chat name -->
    <div class="modal" id="newChatModal">
        <div class="modal-content">
            <h3>Name your chat</h3>
            <input type="text" id="chatNameInput" placeholder="Enter chat name">
            <div class="modal-buttons">
                <button onclick="closeModal()">Cancel</button>
                <button onclick="confirmNewChat()">Create</button>
            </div>
        </div>
    </div>

    <!-- Add this modal HTML after your existing modals -->
    <div class="modal" id="generateProblemModal">
        <div class="modal-content">
            <h3>Generate New Problem</h3>
            <p class="modal-description">Describe the type of coding problem you want to generate:</p>
            <textarea 
                id="problemPromptInput" 
                placeholder="E.g., Generate a medium difficulty problem about array manipulation..."
                rows="4"
            ></textarea>
            <div class="status-message" id="generateStatus"></div>
            <div class="modal-buttons">
                <button onclick="closeGenerateModal()">Cancel</button>
                <button onclick="generateProblem()" class="primary" id="generateBtn">Generate</button>
            </div>
        </div>
    </div>

    <script>
        // Wait for the page to fully load, then fade out the loader
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 800);  // Smooth fade-out animation
            }, 2500);    // Show loader for 2.5 seconds
        });

        const navBtns = document.querySelectorAll('.nav-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        // Handle switching between different tabs (Home, Workspace, About)
        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Reset all tabs to inactive state
                navBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Activate the clicked tab
                btn.classList.add('active');
                const tabId = btn.getAttribute('data-tab');
                const targetContent = document.getElementById(tabId);
                targetContent.classList.add('active');

                // Special handling for workspace view
                if (tabId === 'workspace') {
                    document.body.style.overflow = 'hidden'; // Lock scrolling in workspace
                    targetContent.style.paddingTop = '0'; // Remove spacing for workspace
                } else {
                    document.body.style.overflow = ''; // Allow scrolling in other tabs
                    targetContent.style.paddingTop = '80px'; // Add spacing for nav bar
                }
            });
        });

        // Store all chat histories and track which chat is currently active
        let chats = {}; // Each chat will have its own message history
        let currentChat = null; // Keep track of which chat we're viewing
        let isUserSignedIn = false; // Track user's login status

        // Create a new chat conversation
        function createNewChat() {
            // Get any message that was typed before creating chat
            const input = document.querySelector('.chat-input');
            const initialMessage = input.value.trim();

            // Show the "Name your chat" popup
            const modal = document.getElementById('newChatModal');
            modal.style.display = 'flex';
            const chatNameInput = document.getElementById('chatNameInput');
            chatNameInput.value = ''; // Clear any previous name
            chatNameInput.focus();

            // Save the initial message to use after chat creation
            if (initialMessage) {
                modal.setAttribute('data-initial-message', initialMessage);
            } else {
                modal.removeAttribute('data-initial-message');
            }
        }

        function closeModal() {
            const modal = document.getElementById('newChatModal');
            modal.style.display = 'none';
            document.getElementById('chatNameInput').value = '';
            modal.removeAttribute('data-initial-message');
        }

        function confirmNewChat() {
            const chatName = document.getElementById('chatNameInput').value.trim();
            const modal = document.getElementById('newChatModal');
            const initialMessage = modal.getAttribute('data-initial-message');

            if (chatName) {
                // Create new chat with the given name
                const chatHistory = document.querySelector('.chat-history');
                const chatId = 'chat_' + Date.now();
                const newChat = document.createElement('div');
                newChat.className = 'history-item';
                newChat.setAttribute('data-chat-id', chatId);
                newChat.innerHTML = `
                    <span>${chatName}</span>
                    <span class="delete-chat" onclick="deleteChat(this)">×</span>
                `;

                // Remove active class from all chats
                document.querySelectorAll('.history-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Add active class to new chat
                newChat.classList.add('active');

                // Initialize chat history
                chats[chatId] = [];
                currentChat = chatId;

                chatHistory.appendChild(newChat);

                // Clear welcome message
                const welcomeMessage = document.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.style.display = 'none';
                }

                // Clear chat display
                const chatMessages = document.querySelector('.chat-messages');
                chatMessages.innerHTML = '<div class="messages-container"></div>';

                // Close the modal
                closeModal();

                // Send the initial message if it exists
                if (initialMessage) {
                    setTimeout(() => {
                        const input = document.querySelector('.chat-input');
                        input.value = initialMessage;
                        sendMessage();
                    }, 100);
                }
            }
        }

        function addNewChat(name) {
            const chatHistory = document.querySelector('.chat-history');
            const chatId = 'chat_' + Date.now();
            const newChat = document.createElement('div');
            newChat.className = 'history-item';
            newChat.setAttribute('data-chat-id', chatId);
            newChat.innerHTML = `
                <span>${name}</span>
                <span class="delete-chat" onclick="deleteChat(this)">×</span>
            `;

            // Remove active class from all chats
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to new chat
            newChat.classList.add('active');

            // Initialize chat history
            chats[chatId] = [];
            currentChat = chatId;

            // Add click event to switch between chats
            newChat.addEventListener('click', (e) => {
                if (!e.target.classList.contains('delete-chat')) {
                    switchChat(chatId);
                }
            });

            chatHistory.appendChild(newChat);

            // Clear welcome message and prepare chat area
            const welcomeMessage = document.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }

            // Clear chat display
            const chatMessages = document.querySelector('.chat-messages');
            chatMessages.innerHTML = '<div class="messages-container"></div>';
        }

        function switchChat(chatId) {
            // Update active state in sidebar
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-chat-id="${chatId}"]`).classList.add('active');

            // Update current chat
            currentChat = chatId;

            // Display chat messages
            displayChatMessages(chatId);
        }

        function displayChatMessages(chatId) {
            const chatMessages = document.querySelector('.chat-messages');
            chatMessages.innerHTML = `<div class="messages-container">
                ${chats[chatId].map(msg => createMessageHTML(msg)).join('')}
            </div>`;

            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function createMessageHTML(message) {
            const formattedText = message.text.trim()
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            return `<div class="message ${message.sender}"><div class="message-content">${formattedText}</div></div>`;
        }

        function deleteChat(element) {
            const chatItem = element.parentElement;
            const chatId = chatItem.getAttribute('data-chat-id');

            // Delete chat history
            delete chats[chatId];

            // Remove chat from sidebar
            chatItem.remove();

            // Reset current chat if deleted
            if (currentChat === chatId) {
                currentChat = null;
            }

            // If no chats left, show welcome message
            const chatHistory = document.querySelector('.chat-history');
            if (chatHistory.children.length === 0) {
                const welcomeMessage = document.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.style.display = 'block';
                }
                document.querySelector('.chat-messages').innerHTML = '';
            }
        }

        // Close modal when clicking outside
        document.getElementById('newChatModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Handle Enter key in chat name input
        document.getElementById('chatNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmNewChat();
            }
        });

        // Update the chat input event listeners
        document.querySelector('.chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const message = this.value.trim();
                if (message) {
                    if (!currentChat) {
                        // Show modal with the message
                        createNewChat();
                    } else {
                        sendMessage();
                    }
                }
            }
        });

        document.querySelector('.send-button').addEventListener('click', function() {
            const input = document.querySelector('.chat-input');
            const message = input.value.trim();
            if (message) {
                if (!currentChat) {
                    // Show modal with the message
                    createNewChat();
                } else {
                    sendMessage();
                }
            }
        });

        // Handle sending messages in the chat
        async function sendMessage(messageText = null) {
            const input = document.querySelector('.chat-input');
            const message = messageText || input.value.trim();

            if (!message || !currentChat) return;

            try {
                if (!messageText) {
                    // Clear input field and show user's message
                    input.value = '';
                    addMessage(message, 'user');
                }

                // Show "Thinking..." while waiting for response
                const loadingId = Date.now();
                addMessage("Thinking...", 'eve', loadingId);

                // Send message to the server
                const response = await fetch('http://127.0.0.1:5000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        video: message.toLowerCase().includes('solve') // Check if we need a video response
                    })
                });

                // Remove the "Thinking..." message
                removeMessage(loadingId);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    // Show Eve's response
                    addMessage(data.message, 'eve');

                    // If there's a video, show it
                    if (data.video) {
                        const videoContainer = document.createElement('div');
                        videoContainer.className = 'message eve';
                        videoContainer.innerHTML = `
                            <div class="message-content video-content">
                                <video src="http://127.0.0.1:5000/video/${data.video}" 
                                       controls 
                                       preload="auto" 
                                       style="max-width: 100%; border-radius: 8px;" 
                                       playsinline></video>
                            </div>
                        `;
                        const messagesContainer = document.querySelector('.messages-container');
                        if (messagesContainer) {
                            messagesContainer.appendChild(videoContainer);
                            // Make sure newest messages are visible
                            const chatMessages = document.querySelector('.chat-messages');
                            if (chatMessages) {
                                chatMessages.scrollTop = chatMessages.scrollHeight;
                            }
                        }
                    }
                } else {
                    addMessage("Sorry, I encountered an error. Please try again.", 'eve');
                }
            } catch (error) {
                console.error('Error:', error);
                addMessage("Sorry, I'm having trouble connecting to the server.", 'eve');
            }
        }

        // Add function to remove loading message
        function removeMessage(messageId) {
            const messages = document.querySelectorAll('.message');
            messages.forEach(message => {
                if (message.dataset.id === String(messageId)) {
                    message.remove();
                }
            });
        }

        // Update the addMessage function
        function addMessage(text, sender, messageId = null) {
            if (!currentChat) return;

            // Create message container if it doesn't exist
            let messagesContainer = document.querySelector('.messages-container');
            if (!messagesContainer) {
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages) {
                    messagesContainer = document.createElement('div');
                    messagesContainer.className = 'messages-container';
                    chatMessages.appendChild(messagesContainer);
                }
            }

            if (!messagesContainer) return;

            // Add to chat history
            const messageObj = { text: text.trim(), sender };
            chats[currentChat].push(messageObj);

            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}`;
            if (messageId) {
                messageElement.dataset.id = messageId;
            }

            // Create message content
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = formatMessage(text);

            // Assemble and append message
            messageElement.appendChild(messageContent);
            messagesContainer.appendChild(messageElement);

            // Scroll to bottom
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function formatMessage(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        function updateAuthButtons() {
            const profileButton = document.getElementById('profileButton');
            const sidebarSignInButton = document.getElementById('sidebarSignInButton');

            if (isUserSignedIn) {
                profileButton.style.display = 'flex';
                sidebarSignInButton.style.display = 'none';
            } else {
                profileButton.style.display = 'none';
                sidebarSignInButton.style.display = 'flex';
            }
        }

        // Call this function when page loads
        updateAuthButtons();

        // Example of how to handle sign in/out
        document.getElementById('sidebarSignInButton').addEventListener('click', function() {
            // Add your sign in logic here
            // After successful sign in:
            isUserSignedIn = true;
            updateAuthButtons();
        });

        // Run code in the code editor
        async function runCode() {
            const codeEditor = document.getElementById('codeEditor');
            const outputPanel = document.getElementById('outputPanel');
            
            if (!codeEditor || !outputPanel) return;
            
            const code = codeEditor.value;
            outputPanel.textContent = 'Running...';
            outputPanel.classList.add('loading');

            try {
                // Send code to server for execution
                const response = await fetch('http://127.0.0.1:5000/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ code })
                });

                const data = await response.json();
                outputPanel.classList.remove('loading');

                // Show the results
                if (data.success) {
                    outputPanel.textContent = data.output || 'Code executed successfully with no output';
                } else {
                    outputPanel.textContent = `Error: ${data.error || 'Unknown error occurred'}`;
                    outputPanel.classList.add('error');
                }
            } catch (error) {
                outputPanel.classList.remove('loading');
                outputPanel.classList.add('error');
                outputPanel.textContent = `Error connecting to server: ${error.message}`;
            }
        }

        // Handle dark/light theme
        function initTheme() {
            // Load saved theme preference or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        // Switch between dark and light themes
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            
            if (sunIcon && moonIcon) {
                if (theme === 'light') {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                } else {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                }
            }
        }

        // Initialize theme
        initTheme();

        // Add click handler to theme toggle button
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        function switchTab(tabId) {
            // Remove active class from all buttons and contents
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to corresponding content
            const targetContent = document.getElementById(tabId);
            targetContent.classList.add('active');

            // Handle workspace view
            if (tabId === 'workspace') {
                document.body.style.overflow = 'hidden';
                targetContent.style.paddingTop = '0';
            } else {
                document.body.style.overflow = '';
                targetContent.style.paddingTop = '80px';
            }
        }

        // Update the initialization to remove problems-related code
        document.addEventListener('DOMContentLoaded', function() {
            // Remove this line
            const problemsTab = document.querySelector('[data-tab="problems"]');
            if (problemsTab) {
                problemsTab.addEventListener('click', loadProblems);
            }

            // Remove these lines
            const problemCodeEditor = document.getElementById('problemCodeEditor');
            if (problemCodeEditor) {
                problemCodeEditor.addEventListener('input', updateProblemLineNumbers);
                problemCodeEditor.addEventListener('scroll', syncProblemScroll);
            }
        });
    </script>
</body>
</html>